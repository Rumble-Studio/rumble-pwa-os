<div class="tasks-list-container">
	<div class="refresh-time">
		<div class="auto-refresh">
			<span>Refresh list every: </span>
			<input
				class="refresh-time-input"
				type="number"
				min="1"
				[(ngModel)]="refreshTime" />
			<span>sec</span>
		</div>

		<button
			(click)="onRefreshTask()"
			class="refresh-button">
			Sync
		</button>
	</div>

	<mat-form-field appearance="outline">
		<mat-label>Filter</mat-label>
		<input
			matInput
			(keyup)="applyFilter($event)"
			#input />
	</mat-form-field>

	<table
		#table
		mat-table
		*ngIf="dataSource.data.length; else noDataTpl"
		[dataSource]="dataSource"
		matSort
		multiTemplateDataRows>
		<ng-container matColumnDef="id">
			<th
				mat-header-cell
				*matHeaderCellDef
				mat-sort-header>
				id
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				{{ element.id.substring(0, 5) }}
			</td>
		</ng-container>

		<ng-container matColumnDef="timeCreation">
			<th
				mat-header-cell
				*matHeaderCellDef
				mat-sort-header>
				timeCreation
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				{{ element.timeCreation }}
			</td>
		</ng-container>

		<ng-container matColumnDef="title">
			<th
				mat-header-cell
				*matHeaderCellDef
				mat-sort-header>
				Title
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				{{ element.title }}
			</td>
		</ng-container>

		<ng-container matColumnDef="submitted">
			<th
				mat-header-cell
				*matHeaderCellDef
				mat-sort-header>
				Submitted
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				<span *ngIf="!element.submitted"> - </span>
				<span *ngIf="element.submitted"> V </span>
			</td>
		</ng-container>

		<ng-container matColumnDef="complete">
			<th
				mat-header-cell
				*matHeaderCellDef
				mat-sort-header>
				Completed
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				<span *ngIf="!element.completed"> - </span>
				<span *ngIf="element.completed"> V </span>
			</td>
		</ng-container>

		<ng-container matColumnDef="failed">
			<th
				mat-header-cell
				*matHeaderCellDef
				mat-sort-header>
				Failed
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				<span *ngIf="!element.failed"> - </span>
				<span *ngIf="element.failed"> X </span>
			</td>
		</ng-container>
		<ng-container matColumnDef="args">
			<th
				mat-header-cell
				*matHeaderCellDef
				mat-sort-header>
				Args
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				{{ element.argsJson }}
			</td>
		</ng-container>
		<ng-container matColumnDef="result">
			<th
				mat-header-cell
				*matHeaderCellDef
				mat-sort-header>
				Result
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				{{ element.resultJson?.substring(0, 100) }}
			</td>
		</ng-container>

		<ng-container matColumnDef="progress">
			<th
				mat-header-cell
				*matHeaderCellDef
				mat-sort-header>
				Progress
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				<span *ngIf="element.progress === -1"> - </span>
				<span *ngIf="element.progress > -1"> {{ element.progress * 100 }}% </span>
			</td>
		</ng-container>

		<ng-container matColumnDef="reload">
			<th
				mat-header-cell
				*matHeaderCellDef>
				Reload
			</th>
			<td
				mat-cell
				*matCellDef="let element">
				<button
					mat-raised-button
					(click)="onReloadAsk(element.id)">
					Reload
				</button>
			</td>
		</ng-container>

		<ng-container matColumnDef="expandedDetail">
			<td
				mat-cell
				*matCellDef="let element"
				[attr.colspan]="displayedColumns.length">
				<div
					class="element-detail"
					[@detailExpand]="element === expandedElement ? 'expanded' : 'collapsed'">
					<div class="element-description">
						{{ element?.resultJson }}
					</div>
				</div>
			</td>
		</ng-container>

		<tr
			mat-header-row
			*matHeaderRowDef="displayedColumns"></tr>
		<tr
			mat-row
			*matRowDef="let row; columns: displayedColumns; let element"
			[ngClass]="{
				failed: element.failed,
				completed: element.completed,
				submitted: element.submitted
			}"
			[class.expanded-row]="expandedElement === element"
			(click)="expandedElement = expandedElement === element ? null : element"></tr>
		<tr
			mat-row
			*matRowDef="let row; columns: ['expandedDetail']"
			class="detail-row"></tr>

		<tr
			class="mat-row"
			*matNoDataRow>
			<td
				class="mat-cell"
				colspan="4">
				No data matching the filter "{{ input.value }}"
			</td>
		</tr>
	</table>

	<mat-paginator
		[pageSizeOptions]="[5, 10, 25, 100]"
		aria-label="Select page of users"
		[pageSize]="10"></mat-paginator>
</div>
<ng-template #noDataTpl>
	<span class="no-data">No task available</span>
</ng-template>
